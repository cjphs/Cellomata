(()=>{var t={202:(t,e,n)=>{"use strict";n.r(e),n.d(e,{interpretRules:()=>w,recalc_grid_size:()=>f,reset_grid:()=>g,state_cols:()=>d,variables:()=>y});var i=n(306);const l=["with","w/","w"],s=["chance","probability","prob","%"],o=["becomes:","->",":"],r=["and","&"],a=["@width","@w"],c=["@height","@h"],h=["@wrap"],u=["@colors","@colours"];let d={},g=!1,f=!1,p=[],y={};const w=function(t){console.log(t);let e=100,n=100,d=!1,y=0,w=null,m="",C={},E={};return f=!1,t.split("\n").forEach((t=>{if("#"!==(t=t.trim()).charAt(0)&&""!==t.trim())switch(y){case 0:const B=t.replaceAll(" ","").split(",");let P=0;B.forEach((t=>{p.includes(t)&&P++})),g=!(P==p.length),p=B,w=new i.Ruleset(p),console.log(p,"STATES"),y=1;break;case 100:const W=t.replaceAll(" ","").split(",");let L=0;p.forEach((t=>{E[t]=W[L++]})),y=1;break;case 1:var k,I=t.split(" ");if(b(I[0],a))(k=I[1]in C?parseInt(C[I[1]]):parseInt(I[1]))!=e&&(e=k,g=!0,f=!0);else if(b(I[0],c)){var R;(R=I[1]in C?parseInt(C[I[1]]):parseInt(I[1]))!=n&&(n=R,g=!0,f=!0)}else b(I[0],h)&&(d="true"===I[1]);b(I[0],u)?y=100:I.length>1&&b(I[1],o)?(m=I[0],y=2):I.length>1&"="==I[1]&&(C[I[0]]=I[2],console.log(C));break;case 2:S("DEFINE_CONDITIONALS"),I=t.split(" "),console.log(I[I.length-1].slice(-1));var _=!1;"."==I[I.length-1].slice(-1)&&(S("TERMINATION "+I[0]),1==I.length&&(I[0]=I[0].slice(0,-1)),_=!0);var A=1;if(I.length>1&&b(I[1],l)&&b(I[2],s)&&(S("CHANCE"),I[3]in C&&(I[3]=C[I[3]]),A=parseFloat(I[3]),I.splice(1,3)),I.length>1&&"if"==I[1]){S("IF");for(var M=!1,D=null;!M;){var T=I[2].split("*");let t="",e=-1,n="=",l=1,s=9;if(T.length>1){let e=v(T[0]);l=e[0],s=e[1],t=T[1]}else t=T[0];const o=I[3];let a=new i.Clause(I[0],o,t,e,A,l,s);a.equality_type=n,w.addRule(m,a),null!=D&&(D.conjunctWith(a),a.do_evaluation=!1),I.length>4&&b(I[4],r)?(D=a,I.splice(2,3)):M=!0}}else{let t=new i.Clause(I[0],"always","",-1,A);w.addRule(m,t)}_&&(y=1)}})),console.log(w),{gridWidth:e,gridHeight:n,ruleset:w,wrap:d,stateCols:E}};function v(t){let e,n;if("["===t[0]&&"]"===t[t.length-1])t=(t=t.substring(1,t.length-1)).split(","),e=m(t[0]),n=m(t[1]);else if(">"===t[0]||"<"===t[0]){const i="="===t[1],l=t[0];t=t.substring(i?2:1,t.length),">"===l?(e=m(t),n=1/0,i||(e+=1)):"<"===l&&(e=0,n=m(t),i||(n+=1))}else e=m(t),n=e;return[e,n]}const m=function(t){return t in y?parseInt(y[t]):parseInt(t)},b=function(t,e){return e.includes(t.toLowerCase())},S=function(t){console.log("INTERPRETER: "+t)}},803:(t,e,n)=>{"use strict";n.r(e),n.d(e,{clearGrid:()=>_,evolveDraw:()=>M,loadPreset:()=>T,pauseUnpause:()=>b,play:()=>E,recalculateGridSize:()=>d,updateRules:()=>R});var i=n(306),l=n(202),s=n(632);const o=document.getElementById("grid-canvas"),r=o.getContext("2d");let a=64,c=64,h=o.clientWidth/a,u=o.clientHeight/c;function d(){S(),console.log("???"),h=o.clientWidth/a,u=o.clientHeight/c,g.width=a,g.height=c,A(I,!1),console.log("???>>")}let g=null,f=!1,p=0,y="",w=null,v={};const m=function(){if(console.log(g),null!=g){console.log(g);for(let t=0;t<c;t++)for(let e=0;e<a;e++)r.fillStyle=v[g.getCellState(e,t)],r.fillRect(Math.floor(h*e),Math.floor(u*t),Math.ceil(h),Math.ceil(u))}},b=function(){f?S():(C(),E())},S=function(){f=!1,document.getElementById("play-button").innerHTML="Play"},C=function(){f=!0,document.getElementById("play-button").innerHTML="Pause"},E=function(){console.log("frame"),f&&(p++%10==0&&M(),requestAnimationFrame(E))},k=function(t){null!=w&&(w.style.boxShadow="none"),w=document.getElementById(t),w.style.boxShadow="white 0 0 10px",y=t};let I=null;const R=function(t=!1){const e=document.getElementById("rule_input_box").value||I;if(""==e)return;const n=(0,l.interpretRules)(e);a=n.gridWidth,c=n.gridHeight,I=n.ruleset,console.log(I),v=n.stateCols,console.log(n),console.log("wah?");const s=document.getElementById("state_picker");s.innerHTML="",I.states.forEach((t=>{v[t];const e=document.createElement("div");e.id=t,e.className="state",e.style.backgroundColor=v[t],e.onclick=function(){k(t)},s.appendChild(e)})),null==g||n.gridWidth!=g.width||n.gridHeight!=g.height?(g=new i.Grid(n.gridWidth,n.gridHeight,I,v,n.wrap),d()):g.rules=I,console.log(g),t?(d(),A(I)):k(y)},_=function(){g.resetGrid(),console.log("rerrr"),k(g.rules.getDefaultState()),m()},A=function(t,e=!0){g.resetGrid(e),k(t.getDefaultState()),m()},M=function(){g.evolve(),m()};m(),document.onkeydown=function(t){if((t=t||window).ctrlKey)switch(t.key){case"s":R(),m(),t.preventDefault(),t.stopPropagation();break;case"x":_()}};let D=!1;o.addEventListener("mousedown",(function(){D=!0}),!1),o.addEventListener("mouseup",(function(){D=!1}),!1),o.addEventListener("mousemove",(t=>{if(D){const e=t.target.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,l=Math.floor(n/h),s=Math.floor(i/u);g.setCellState(l,s,y),m()}}),!1);const T=function(t){I=s.default.get(t),console.log(I),document.getElementById("rule_input_box").value=I,R(!0)};console.log("wuppa"),T("life"),document.addEventListener("DOMContentLoaded",(function(){document.getElementById("step").addEventListener("click",(function(){console.log("evolve"),g.evolve(),console.log("draw"),m()})),document.getElementById("updateRules").addEventListener("click",R),document.getElementById("clear-grid").addEventListener("click",_),document.getElementById("play-button").addEventListener("click",b)}))},632:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});const i=new Map;i.set("life","Void, Dead, Alive\n@colors\nblack, black, white\n\np = .2\n\nVoid ->\nAlive with chance p\nDead otherwise.\n\nDead ->\nAlive if 3*Alive nearby\nDead otherwise.\n\nAlive ->\nAlive if [2,3]*Alive nearby\nDead otherwise.\n\n@width 100\n@height 100\n@wrap true"),i.set("rockpaperscissors","Nil, Rock, Paper, Scissors\n@colors\nblack, red, yellow, orange\n\nNil ->\nRock with chance .3\nPaper with chance .3\nScissors with chance .3\nNil.\n\nt = 3\np = 1\n\nRock ->\nPaper with prob p if >=t*Paper nearby\nRock otherwise.\n\nPaper ->\nScissors with prob p if >=t*Scissors nearby\nPaper otherwise.\n\nScissors ->\nRock with prob p if >=t*Rock nearby\nScissors otherwise.\n\n@width 100\n@height 100\n@wrap true"),i.set("cave","Void, Air, Wall\n@colors\nblack, white, black\n\np = .5\n\nVoid ->\nAir with chance p\nWall.\n\nq = .9\n\nAir ->\nWall with prob q if >4*Wall nearby\nAir.\n\nWall ->\nWall if >3*Wall nearby\nAir.\n\n@width 64\n@height 64\n@wrap true");const l=i},306:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Clause:()=>i,Grid:()=>s,Ruleset:()=>l});class i{constructor(t,e,n="",i=-1,l=1,s=0,o=9){this.transformState=t,this.localityCheckType=e,this.localityCheckState=n,this.localityCount=i,this.localityRangeMin=s,this.localityRangeMax=o,this.chance=l,this.conjucted_with=null,this.do_evaluation=!0,this.equality_type="="}conjunctWith=function(t){this.conjucted_with=t};evaluate=function(t){if(Math.random()>=this.chance)return!1;switch(this.localityCheckType){case"always":return!0;case"nearby":let e=t[this.localityCheckState];return this.localityRangeMin<=e&&e<=this.localityRangeMax;case"majority":let n=0,i="";return states.forEach((e=>{t[e]>n&&(n=t[e],i=e)})),i===this.localityCheckState;default:return 0!==this.localityCount?t["*"+this.localityCheckType]===this.localityCheckState:t["*"+this.localityCheckType]!==this.localityCheckState}}}class l{constructor(t){this.states=t,this.clauses={},this.states.forEach((t=>{this.clauses[t]=[]})),console.log(this.states),console.log(this.clauses)}addRule=function(t,e){this.clauses[t].push(e)};getDefaultState=function(){return this.states[0]};getStatesDict=function(t=0){const e={};return this.states.forEach((n=>{e[n]=t})),e}}class s{constructor(t,e,n,i,l){this.width=t,this.height=e,this.rules=n,this.wrap=l,this.grid=this.getEmptyGrid(),this.stateCounts={},this.stateCols={},console.log("maybe"),this.rules.states.forEach((t=>{this.stateCounts[t]=0}))}getEmptyGrid=function(){console.log("callme");const t=[[]];for(let e=0;e<this.height;e++){t[e]=[];for(let n=0;n<this.width;n++)t[e][n]=this.rules.getDefaultState()}return t};getStateCounts=function(){return this.stateCounts};resetGrid=function(t=!1){if(t)for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.rules.states.includes(this.getCellState(e,t))||this.setCellState(e,t,this.rules.getDefaultState());else console.log("hey i just"),this.grid=this.getEmptyGrid()};coordinatesInBounds=function(t,e){return t>=0&t<this.width&e>=0&e<this.height};getCellState=function(t,e){this.wrap&&(t=(this.width+t)%this.width,e=(this.height+e)%this.height);var n="";return this.coordinatesInBounds(t,e)&&(n=this.grid[e][t]),n};setCellState=function(t,e,n){this.coordinatesInBounds(t,e)&&(this.grid[e][t]=n)};evolve=function(){console.log("hey i just");var t=this.getEmptyGrid();let e={};this.rules.states.forEach((t=>{e[t]=0}));for(var n=0;n<this.height;n++)for(var i=0;i<this.width;i++){var l=this.getCellState(i,n);t[n][i]=l;for(var s=this.rules.getStatesDict(),o=i-1;o<i+2;o++)for(var r=n-1;r<n+2;r++)if(o!=i||r!=n){var a=this.getCellState(o,r);""!=a&&(s[a]+=1)}s["*below"]=this.getCellState(i,n+1),s["*above"]=this.getCellState(i,n-1),s["*left"]=this.getCellState(i-1,n),s["*right"]=this.getCellState(i+1,n),s["*bottomleft"]=this.getCellState(i-1,n+1),s["*bottomright"]=this.getCellState(i+1,n+1),s["*topleft"]=this.getCellState(i-1,n-1),s["*topright"]=this.getCellState(i+1,n-1);t:for(let o=0;o<this.rules.clauses[l].length;o++){let r=this.rules.clauses[l][o];if(!r.do_evaluation)continue t;let a=r.evaluate(s);if(a)for(;null!=r.conjucted_with&&(r=r.conjucted_with,a=r.evaluate(s),a););if(a){t[n][i]=r.transformState,e[t[n][i]]+=1;break t}}}this.stateCounts=e,this.grid=t};asString=function(t=!1,e=",",n="\n"){let i="";for(let t=0;t<this.height;t++){for(let n=0;n<this.width;n++)i+=this.grid[t][n]+(n<this.width-1?e:"");i+=n}return i}}}},e={};function n(i){var l=e[i];if(void 0!==l)return l.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(202),n(632),n(306),n(803)})();